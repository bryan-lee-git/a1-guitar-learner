window.AudioContext=window.AudioContext||window.webkitAudioContext;var timer,noteCount,counting,context=new AudioContext,accentPitch=380,offBeatPitch=200,delta=0,curTime=0;function schedule(){for(;curTime<context.currentTime+.1;)playNote(curTime),updateTime();timer=window.setTimeout(schedule,.1)}function updateTime(){curTime+=60/parseInt($(".bpm-input").val(),10),noteCount++}function playNote(t){var e=context.createOscillator();noteCount==parseInt($(".ts-top").val(),10)&&(noteCount=0),$(".counter .dot").eq(noteCount).hasClass("active")?e.frequency.value=accentPitch:e.frequency.value=offBeatPitch,e.connect(context.destination),e.start(t),e.stop(t+.05),$(".counter .dot").attr("style",""),$(".counter .dot").eq(noteCount).css({transform:"translateY(-10px)",background:"#F75454"})}function countDown(){var t=$(".timer");parseInt(t.val(),10)>0&&!0===counting?(t.val(parseInt(t.val(),10)-1),window.setTimeout(countDown,1e3)):($(".play-btn").click(),t.val(60))}$("document").ready(function(){$(".ts-top").trigger("change"),$("header").fitText(1,{maxFontSize:"46px"})}),$(".tap-btn").click(function(){var t=new Date,e=parseInt(t.getTime(),10);$(".bpm-input").val(Math.ceil(6e4/(e-delta))),delta=e}),$(".bpm-minus, .bpm-plus").click(function(){$(this).hasClass("bpm-minus")?$(".bpm-input").val(parseInt($(".bpm-input").val(),10)-1):$(".bpm-input").val(parseInt($(".bpm-input").val(),10)+1)}),$(".beat-range, .accent-range").change(function(){$(this).hasClass("beat-range")?offBeatPitch=$(this).val():accentPitch=$(this).val()}),$(document).on("click",".counter .dot",function(){$(this).toggleClass("active")}),$(".options-btn").click(function(){$(".options").toggleClass("options-active")}),$(".ts-top, .ts-bottom").on("change",function(){var t=$(".counter");t.html("");for(var e=0;e<parseInt($(".ts-top").val(),10);e++){var n=document.createElement("div");n.className="dot",0===e&&(n.className+=" active"),t.append(n)}}),$(".play-btn").click(function(){"pause"===$(this).data("what")?(counting=!1,window.clearInterval(timer),$(".counter .dot").attr("style",""),$(this).data("what","play").attr("style","").text("Play")):($("#timer-check").is(":checked")&&(counting=!0,countDown()),curTime=context.currentTime,noteCount=parseInt($(".ts-top").val(),10),schedule(),$(this).data("what","pause").css({background:"#F75454",color:"#FFF"}).text("Stop"))});